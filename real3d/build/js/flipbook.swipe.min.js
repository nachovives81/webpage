var FLIPBOOK=FLIPBOOK||{};FLIPBOOK.BookSwipe=function(i,t,e,s){this.options=s,this.main=e,this.singlePage=s.singlePageMode,this.singlePage&&(this.view=1),this.pageWidth=this.options.pageWidth,this.pageHeight=this.options.pageHeight,this.slides=[],this.pagesArr=[],this.leftPage=0,this.rightPage=0,this.rotation=0,this.prevPageEnabled=!1,this.setRightIndex(s.rightToLeft?s.pages.length:0),this.currentSlide=0,this.flipping=!1,this.wrapper=t,this.scroller=i,this.scroller.classList.remove("book"),this.scroller.classList.add("flipbook-carousel-scroller"),this.iscroll=new IScroll(this.wrapper,{snap:!0,snapSpeed:200*this.options.pageFlipDuration,freeScroll:!0,scrollX:!0,scrollY:!1,preventDefault:!1,eventPassthrough:"vertical"});var o,l=this;this.zoomDisabled=!1,this.iscroll.on("scrollStart",(function(){l.zoomDisabled=!0})),this.iscroll.on("scrollEnd",(function(){l.zoomDisabled=!1}));for(var h=0;h<3;h++){var n=document.createElement("div");n.className="flipbook-carousel-slide";var r=document.createElement("div");r.className="slide-inner",n.appendChild(r),this.scroller.appendChild(n),this.slides.push(n)}this.slides[0].iscroll=new IScroll(this.slides[0],{zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,keepInCenterV:!0,keepInCenterH:!0,preventDefault:!1}),this.slides[2].iscroll=new IScroll(this.slides[2],{zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,keepInCenterV:!0,keepInCenterH:!0,preventDefault:!1}),this.slides[1].iscroll=new IScroll(this.slides[1],{zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,keepInCenterV:!0,keepInCenterH:!0,preventDefault:!1});for(h=0;h<3;h++)this.slides[h].iscroll.on("zoomEnd",(function(){var i=s.main.zoom;this.options.eventPassthrough=i>1?"":"vertical",this.options.freeScroll=i>1,this.refresh()}));this.resizeInnerSlides(),s.pages.forEach(((i,t)=>{if(!i.empty){const e=new FLIPBOOK.PageSwipe(this,t,i.src,i.htmlContent);this.pagesArr.push(e),s.loadAllPages&&e.load()}})),s.cover||(o=new FLIPBOOK.PageSwipe(this,s.numPages),this.pagesArr.push(o)),this.iscroll.on("scrollStart",(function(){this.distX<0?l.loadNextSpread():l.loadPrevSpread()})),this.iscroll.on("scrollEnd",(function(){var i=this.currentPage.pageX;l.currentSlide!=i&&(l.singlePage?i>l.currentSlide?l.setRightIndex(l.rightIndex+1):i<l.currentSlide&&l.setRightIndex(l.rightIndex-1):i>l.currentSlide?l.setRightIndex(l.rightIndex+2):i<l.currentSlide&&l.setRightIndex(l.rightIndex-2),l.currentSlide=i,l.updateVisiblePages(),l.flipping=!1)})),this.flipEnabled=!0,this.nextEnabled=!0,this.prevEnabled=!0,e.on("enableIScroll",(()=>{this.enableIscroll()})),e.on("disableIScroll",(()=>{this.disableIscroll()})),e.on("pageLoaded",(function(i){}))},FLIPBOOK.BookSwipe.prototype=Object.create(FLIPBOOK.Book.prototype),FLIPBOOK.BookSwipe.prototype.constructor=FLIPBOOK.BookSwipe,FLIPBOOK.BookSwipe.prototype.enableIscroll=function(){this.iscrollDisabled&&(this.zoom>1?(this.slides[0].iscroll&&this.slides[0].iscroll.enable(),this.slides[1].iscroll&&this.slides[1].iscroll.enable(),this.slides[2].iscroll&&this.slides[2].iscroll.enable()):this.iscroll.enable(),this.iscrollDisabled=!1)},FLIPBOOK.BookSwipe.prototype.disableIscroll=function(){this.iscrollDisabled||(this.zoom>1?(this.slides[0].iscroll&&(this.slides[0].iscroll.disable(),this.slides[0].iscroll.initiated=!1),this.slides[1].iscroll&&(this.slides[1].iscroll.disable(),this.slides[1].iscroll.initiated=!1),this.slides[2].iscroll&&(this.slides[2].iscroll.disable(),this.slides[2].iscroll.initiated=!1)):(this.iscroll.disable(),this.iscroll.initiated=!1),this.iscrollDisabled=!0)},FLIPBOOK.BookSwipe.prototype.goToPage=function(i,t){if(this.enabled&&this.flipEnabled){if(i>this.options.pages.length&&(i=this.options.pages.length),(this.singlePage||i%2!=0)&&i--,(isNaN(i)||i<0)&&(i=0),t)return this.setRightIndex(i),void this.updateVisiblePages();this.singlePage?i>this.rightIndex?(this.setSlidePages(this.currentSlide+1,[i]),this.setRightIndex(i-1),this.nextPage(t)):i<this.rightIndex&&(this.setSlidePages(this.currentSlide-1,[i]),this.setRightIndex(i+1),this.prevPage(t)):(this.options.rightToLeft&&!this.options.backCover&&i<2&&(i=2),i>this.rightIndex?i>=this.pagesArr.length?(this.setSlidePages(2,[i-1,i]),this.setRightIndex(i-2),this.goToSlide(2,t)):(this.setSlidePages(this.currentSlide+1,[i-1,i]),this.setRightIndex(i-2),this.nextPage(t)):i<this.rightIndex&&(0==i?(this.setRightIndex(i+2),this.setSlidePages(0,[i]),this.goToSlide(0,t)):(this.setRightIndex(i+2),this.setSlidePages(this.currentSlide-1,[i-1,i]),this.prevPage(t))))}},FLIPBOOK.BookSwipe.prototype.setRightIndex=function(i){this.rightIndex=i},FLIPBOOK.BookSwipe.prototype.nextPage=function(i){2!=this.currentSlide&&(this.flipping=!0,this.goToSlide(this.currentSlide+1,i),this.loadNextSpread())},FLIPBOOK.BookSwipe.prototype.prevPage=function(i){0!=this.currentSlide&&(this.flipping=!0,this.goToSlide(this.currentSlide-1,i),this.loadPrevSpread())},FLIPBOOK.BookSwipe.prototype.enablePrev=function(i){this.prevEnabled=i},FLIPBOOK.BookSwipe.prototype.enableNext=function(i){this.nextEnabled=i},FLIPBOOK.BookSwipe.prototype.setSlidePages=function(i,t){for(var e=this,s=[],o=0;o<t.length;o++)t[o]&&s.push(t[o].index);if(!(this.slides[i].pages&&this.slides[i].pages.length>0&&s.join("")===this.slides[i].pages.join(""))){this.clearSlidePages(i);var l=this.slides[i].firstChild;t.forEach((t=>{let s;s="number"==typeof t?t:t.index,e.pagesArr[s]&&(l.appendChild(e.pagesArr[s].wrapper),e.slides[i].pages.push(s))})),this.resizeInnerSlides(),this.slides[i].iscroll&&this.slides[i].iscroll.refresh()}},FLIPBOOK.BookSwipe.prototype.clearSlidePages=function(i){this.slides[i].firstChild.innerHTML="",this.slides[i].pages=[]},FLIPBOOK.BookSwipe.prototype.loadNextSpread=function(){var i=this.rightIndex;this.options.rightToLeft&&!this.options.backCover&&i--;var t=this.pagesArr[i+1];if(t&&t.load(),!this.singlePage){var e=this.pagesArr[i+2];e&&e.load()}},FLIPBOOK.BookSwipe.prototype.loadPrevSpread=function(){var i,t=this.rightIndex;if(this.options.rightToLeft&&!this.options.backCover&&t--,this.singlePage)(i=this.pagesArr[t-1])&&i.load();else{(i=this.pagesArr[t-2])&&i.load();var e=this.pagesArr[t-3];e&&e.load()}},FLIPBOOK.BookSwipe.prototype.loadVisiblePages=function(){var i=this.options.main,t=this.rightIndex;!this.options.rightToLeft||this.options.backCover||this.singlePage||t--;var e=this.pagesArr[t],s=this.pagesArr[t-1],o=this.pagesArr[t+1],l=this.pagesArr[t+2],h=this.pagesArr[t-2],n=this.pagesArr[t-3];this.singlePage?e?e.load((function(){i.setLoadingProgress(1),s&&s.load(null,!0),o&&o.load(null,!0)})):s&&s.load():s?s.load((function(){e?e.load((function(){i.setLoadingProgress(1),h&&h.load(null,!0),n&&n.load(null,!0),o&&o.load(null,!0),l&&l.load(null,!0)})):(i.setLoadingProgress(1),h&&h.load(null,!0),n&&n.load(null,!0))})):e&&e.load((function(){i.setLoadingProgress(1),o&&o.load(null,!0),l&&l.load(null,!0)}))},FLIPBOOK.BookSwipe.prototype.updateVisiblePages=function(){if(this.visiblePagesRightIndex!==this.rightIndex){this.visiblePagesRightIndex=this.rightIndex;var i=this.rightIndex;!this.options.rightToLeft||this.options.backCover||this.singlePage||i--;var t=this.pagesArr[i],e=this.pagesArr[i-1],s=this.pagesArr[i+1],o=this.pagesArr[i+2],l=this.pagesArr[i-2],h=this.pagesArr[i-3];s&&s.hideHTML(),o&&o.hideHTML(),l&&l.hideHTML(),h&&h.hideHTML(),this.singlePage?(t&&t.startHTML(),e?s?(this.setSlidePages(1,[t]),e&&this.setSlidePages(0,[e]),this.setSlidePages(2,[s]),this.goToSlide(1,!0)):(t&&this.setSlidePages(2,[t]),e&&this.setSlidePages(1,[e]),this.goToSlide(2,!0),this.clearSlidePages(0)):(this.setSlidePages(0,[t]),s?this.setSlidePages(1,[s]):this.clearSlidePages(1),this.goToSlide(0,!0),this.clearSlidePages(2)),e&&e.hideHTML()):e?(e.startHTML(),t?(t.startHTML(),s?l&&(2!=this.rightIndex||this.options.cover)?(this.setSlidePages(1,[e,t]),h?this.setSlidePages(0,[h,l]):this.setSlidePages(0,[l]),o?this.setSlidePages(2,[s,o]):this.setSlidePages(2,[s]),this.goToSlide(1,!0)):(this.setSlidePages(0,[e,t]),o?this.setSlidePages(1,[s,o]):this.setSlidePages(1,[s]),this.clearSlidePages(2)):(this.setSlidePages(2,[e,t]),h?this.setSlidePages(1,[h,l]):this.setSlidePages(1,[l]),this.goToSlide(2,!0),this.clearSlidePages(0))):(this.setSlidePages(2,[e]),h?this.setSlidePages(1,[h,l]):this.setSlidePages(1,[l]),this.goToSlide(2,!0),this.clearSlidePages(0))):(t&&t.startHTML(),this.setSlidePages(0,[t]),o?this.setSlidePages(1,[s,o]):this.setSlidePages(1,[s]),this.goToSlide(0,!0),this.clearSlidePages(2)),this.loadVisiblePages(),this.flippedleft=(this.rightIndex+this.rightIndex%2)/2,this.flippedright=this.options.pages.length/2-this.flippedleft,this.options.main.turnPageComplete()}},FLIPBOOK.BookSwipe.prototype.loadPage=function(i){this.pagesArr[i]&&this.pagesArr[i].load()},FLIPBOOK.BookSwipe.prototype.disable=function(){this.enabled=!1},FLIPBOOK.BookSwipe.prototype.enable=function(){this.enabled=!0,this.onResize()},FLIPBOOK.BookSwipe.prototype.resize=function(){},FLIPBOOK.BookSwipe.prototype.updateSinglePage=function(i){this.singlePageView=i,this.onResize(!0)},FLIPBOOK.BookSwipe.prototype.onResize=function(i){var t=this.main.wrapperW,e=this.main.wrapperH;if(0!=t&&0!=e&&(i||this.w!==t||this.h!==e)){this.w=t,this.h=e;var s=this.pageWidth,o=this.pageHeight,l=2*this.options.zoomMin*s/o>t/e,h=!this.options.singlePageMode&&(!this.options.responsiveView||t>this.options.responsiveViewTreshold||!l||t/e>=this.options.responsiveViewRatio);void 0!==this.singlePageView&&(h=!this.singlePageView);var n,r=h?2*s:s,a=o;this.bw=r,this.bh=a,n=e/t>a/r?a/r*t/this.options.pageHeight:e/this.options.pageHeight;for(var p=0;p<this.slides.length;p++)this.slides[p].style.width=t+0+"px",this.slides[p].style.height=e+"px",this.slides[p].style.left=p*t+0*p+"px",this.slides[p].iscroll&&(this.slides[p].iscroll.options.zoomMin=this.options.zoomMin*n,this.slides[p].iscroll.options.zoomMax=this.options.zoomMax*n,this.slides[p].iscroll.refresh());this.scroller.style.width=this.slides.length*(t+0)+"px",this.iscroll.refresh(),h&&!this.options.singlePageMode||this.singlePage?h&&!this.options.singlePageMode&&this.singlePage&&(this.rightIndex%2!=0&&this.setRightIndex(this.rightIndex+1),this.singlePage=!1,this.view=2,this.resizeInnerSlides()):(this.rightIndex%2==0&&this.rightIndex>0&&this.setRightIndex(this.rightIndex-1),this.singlePage=!0,this.view=1,this.resizeInnerSlides()),this.zoomTo(this.zoom)}},FLIPBOOK.BookSwipe.prototype.isFocusedRight=function(){return this.rightIndex%2==0},FLIPBOOK.BookSwipe.prototype.isFocusedLeft=function(){return this.rightIndex%2==1},FLIPBOOK.BookSwipe.prototype.resizeInnerSlides=function(){var i=this.options.pageHeight*this.pageWidth/this.pageHeight;90!=this.rotation&&270!=this.rotation||(i=this.options.pageHeight*this.pageHeight/this.pageWidth);for(var t=this.singlePage?i:2*i,e=0;e<3;e++)t=this.slides[e].pages&&1==this.slides[e].pages.length?i:2*i,this.slides[e].firstChild.style.width=`${t}px`},FLIPBOOK.BookSwipe.prototype.goToSlide=function(i,t){if(this.iscroll.currentPage.pageX!=i){this.onResize();var e=t?0:600*this.options.pageFlipDuration,s=this.slides[i];s.pages&&s.pages[0]&&this.pagesArr[s.pages[0]].updateHtmlContent(),this.iscroll.pages.length>0&&this.iscroll.goToPage(i,0,e),t&&(this.currentSlide=i),this.zoomTo(this.options.zoomMin)}},FLIPBOOK.BookSwipe.prototype.zoomIn=function(i,t,e){e&&"mousewheel"===e.type||this.zoomTo(i)},FLIPBOOK.BookSwipe.prototype.zoomTo=function(i,t,e,s){if(this.enabled&&!this.zoomDisabled&&(e=e||0,s=s||0,i>1&&this.disableFlip(),0!=l&&0!=h)){var o=this.main,l=o.wrapperW,h=o.wrapperH,n=o.bookW,r=o.bookH,a=o.pageW,p=o.pageH,d=l/h,g=a/p,c=Math.min(this.zoom,1),P=Number(this.options.zoomMin),u=this;!this.options.singlePageMode&&this.options.responsiveView&&l<=this.options.responsiveViewTreshold&&d<2*g&&d<this.options.responsiveViewRatio?(this.view=1,this.sc=g>d?P*d/(g*c):1,l/h>a/p?S():f()):this.singlePage&&d<2*g?(this.sc=g>d?P*d/(g*c):1,l/h>a/p?S():f()):(this.view=2,this.sc=d<2*g?P*d/(2*g*c):1,l/h>=n/r?S():f()),this.zoom=i,this.onZoom(i)}function S(){u.ratio=h/r,m()}function f(){u.ratio=1==u.view?l/a:l/n,m()}function m(){for(var t=0;t<3;t++)u.slides[t].iscroll&&(u.slides[t].iscroll.options.zoomMin=u.ratio*u.options.zoomMin,u.slides[t].iscroll.options.zoomMax=u.ratio*u.options.zoomMax,u.slides[t].iscroll.zoom(u.ratio*i,e,s,0))}},FLIPBOOK.BookSwipe.prototype.zoomOut=function(i){this.zoomTo(i)},FLIPBOOK.BookSwipe.prototype.move=function(i){if(!(this.zoom<=1))for(var t=0;t<3;t++){var e=this.slides[t].iscroll;if(e){var s=e.x,o=e.y,l=20*this.zoom;switch(i){case"left":s+=l;break;case"right":s-=l;break;case"up":o+=l;break;case"down":o-=l}s>0&&(s=0),s<e.maxScrollX&&(s=e.maxScrollX-0),o>0&&(o=0),o<e.maxScrollY&&(o=e.maxScrollY-0),e.scrollTo(s,o,0)}}},FLIPBOOK.BookSwipe.prototype.onZoom=function(i){i>1?(this.disableFlip(),this.enablePan()):(this.enableFlip(),this.disablePan()),this.options.main.onZoom(i)},FLIPBOOK.BookSwipe.prototype.rotateLeft=function(){this.rotation=(this.rotation+360-90)%360;for(var i=0;i<this.pagesArr.length;i++){this.pagesArr[i].setRotation(this.rotation)}this.resizeInnerSlides(),this.onResize()},FLIPBOOK.BookSwipe.prototype.rotateRight=function(){this.rotation=(this.rotation+360+90)%360;for(var i=0;i<this.pagesArr.length;i++){this.pagesArr[i].setRotation(this.rotation)}this.resizeInnerSlides(),this.onResize()},FLIPBOOK.BookSwipe.prototype.onSwipe=function(i,t,e,s){},FLIPBOOK.BookSwipe.prototype.onPageUnloaded=function(i){var t=this.options.rightToLeft?this.options.numPages-i-1:i;this.pagesArr[t].unload()},FLIPBOOK.BookSwipe.prototype.disableFlip=function(){this.flipEnabled=!1,this.iscroll.disable()},FLIPBOOK.BookSwipe.prototype.enableFlip=function(){1!=this.options.numPages?(this.flipEnabled=!0,this.iscroll.enable()):this.disableFlip()},FLIPBOOK.BookSwipe.prototype.enablePan=function(){this.slides[0].iscroll&&this.slides[0].iscroll.enable(),this.slides[1].iscroll&&this.slides[1].iscroll.enable(),this.slides[2].iscroll&&this.slides[2].iscroll.enable()},FLIPBOOK.BookSwipe.prototype.disablePan=function(){this.slides[0].iscroll&&this.slides[0].iscroll.disable(),this.slides[1].iscroll&&this.slides[1].iscroll.disable(),this.slides[2].iscroll&&this.slides[2].iscroll.disable()},FLIPBOOK.PageSwipe=function(i,t,e,s){this.rotation=0,this.index=t,this.options=i.options,this.texture=e,this.html=s,this.index=t,this.wrapper=document.createElement("div"),this.wrapper.classList.add("flipbook-carousel-page"),this.wrapper.dataset.page=t+1,this.main=i.main,this.book=i,this.inner=document.createElement("div"),this.inner.classList.add("flipbook-carousel-page-inner"),this.wrapper.appendChild(this.inner),this.bg=document.createElement("div"),this.bg.classList.add("flipbook-carousel-page-bg"),this.inner.appendChild(this.bg),this.htmlElement=document.createElement("div"),this.htmlElement.classList.add("flipbook-page3-html"),this.htmlElement.style.width=1e3*this.options.pageWidth/this.options.pageHeight+"px",this.htmlElement.style.transform="scale("+this.options.pageHeight/1e3+") translateZ(0)",this.inner.appendChild(this.htmlElement),this.options.doublePage&&(!this.options.rightToLeft&&this.index%2==0&&this.index>0||this.options.rightToLeft&&this.index%2==1&&this.index>0?this.htmlElement.style.left="-100%":this.htmlElement.style.left="0"),this.options.pagePreloader?(this.preloader=document.createElement("img"),this.preloader.src=this.options.pagePreloader,this.preloader.classList.add("flipbook-page-preloader-image"),this.inner.appendChild(this.preloader)):(this.preloader=document.createElement("img"),this.preloader.src=this.options.assets.spinner,this.preloader.classList.add("flipbook-page-preloader"),this.inner.appendChild(this.preloader)),this.setSize(this.pw,this.ph)},FLIPBOOK.PageSwipe.prototype={load:function(i,t){var e=this.options.pageTextureSize;if(this.size>=e)return t||this.loadHTML(),void(i&&i.call(this));this.size=e;var s=this,o=this.options.rightToLeft?this.options.numPages-this.index-1:this.index;this.options.main.loadPage(o,e,(function(l){if((l=l||{})&&l.image){var h=l.image[e]||l.image;h.classList.add("page-carousel-img"),s.index%2!=0||"left"!=s.options.pages[o].side&&"right"!=s.options.pages[o].side||(h.clone||(h.clone=new Image,h.clone.src=h.src),h=h.clone),s.bg.appendChild(h),s.options.rightToLeft?(s.options.doublePage&&s.index<s.options.numPages-1&&s.index%2==1&&(h.style.left="-100%"),s.options.doublePage?s.index==s.options.numPages-1||0==s.index&&s.options.backCover?h.style.width="100%":h.style.width="200%":h.style.width="100%"):(s.options.doublePage&&s.index>0&&s.index%2==0&&(h.style.left="-100%"),s.options.doublePage?0==s.index||s.index==s.options.numPages-1&&s.options.backCover?h.style.width="100%":h.style.width="200%":h.style.width="100%"),s.preloader.remove()}s.setRotation(),t||s.loadHTML(),i&&i.call(s)}))},loadHTML:function(){var i=this,t=this.options.rightToLeft?this.options.numPages-this.index-1:this.index;this.htmlContent?this.updateHtmlContent():this.options.main.loadPageHTML(t,(function(t){i.htmlContent=t,i.updateHtmlContent()}))},hideHTML:function(){this.htmlContentVisible&&(this.htmlElement.innerHTML="",this.htmlContentVisible=!1,this.main.trigger("hidepagehtml",{page:this}))},startHTML:function(){this.book.startPageItems(this.wrapper)},unload:function(){this.pageSize=0,this.size=0,this.inner.appendChild(this.preloader)},dispose:function(){this.pageSize&&(this.pageSize=null,this.bg.innerHTML="")},setSize:function(){var i=this.options.pageWidth,t=this.options.pageHeight;0===this.rotation||180===this.rotation?(this.wrapper.style.width=i+"px",this.wrapper.style.height=t+"px",this.pw=i,this.ph=t):(this.wrapper.style.width=t+"px",this.wrapper.style.height=i+"px",this.pw=t,this.ph=i),this.updateHtmlContent()},setRotation:function(i){this.setSize(),this.options.doublePage||(void 0!==i&&(this.rotation=i),this.img&&(this.img.style.transform="rotate("+this.rotation+"deg) translateZ(0)",90===this.rotation||270===this.rotation?(this.img.style.width=this.wrapper.clientHeight+"px",this.img.style.height=this.wrapper.clientWidth+"px"):(this.img.style.width=this.wrapper.clientWidth+"px",this.img.style.height=this.wrapper.clientHeight+"px")))},updateHtmlContent:function(){this.htmlContent&&!this.htmlContentVisible&&(this.htmlContentVisible=!0,this.htmlElement.innerHTML="",this.htmlElement.appendChild(this.htmlContent),this.main.trigger("showpagehtml",{page:this}))}};