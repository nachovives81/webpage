var FLIPBOOK=FLIPBOOK||{};FLIPBOOK.Book3=function(t,e,i){this.options=i,this.main=e,this.singlePage=i.singlePageMode,this.pageWidth=i.pageWidth,this.pageHeight=i.pageHeight,this.wrapper=t,this.wrapper.classList.add("flipbook-book3"),this.bookLayer=this.wrapper.parentNode,this.flipEasing="easeOutQuad",this.translateZ="",this.iscroll=new FLIPBOOK.IScroll(this.bookLayer,{zoom:!0,scrollX:!0,scrollY:!0,scrollbars:!0,keepInCenterV:!0,keepInCenterH:!0,freeScroll:!0,preventDefault:!1}),e.on("disableIScroll",this.disableIscroll.bind(this)),e.on("enableIScroll",this.enableIscroll.bind(this)),this.iscroll.on("zoomEnd",(()=>{if(isNaN(this.iscroll.scale))return this.zoomTo(i.zoomMin);i.main.onZoom(this.iscroll.scale/this.ratio),this.updateVisiblePages();const t=i.main.zoom>1;if(this.zoomed!==t){const e=this.iscroll.options;e.eventPassthrough=t?"":"vertical",e.freeScroll=t,this.iscroll.refresh(),this.zoomed=t}})),this.wrapper.style.width=2*this.pageWidth+"px",this.wrapper.style.height=`${this.pageHeight}px`,this.centerContainer=document.createElement("div"),this.centerContainer.className="flipbook-center-container3",this.centerContainer.style.width=2*this.pageWidth+"px",this.centerContainer.style.height=`${this.pageHeight}px`,this.wrapper.appendChild(this.centerContainer);const s=this.options.perspective||("3d"===this.options.viewMode?3*this.pageHeight:2e5);this.centerContainer.style.perspective=`${s}px`,this.pagesArr=[],this.animating=!1;let o=this.options.pages.length;this.options.cover||(o+=1);for(let t=0;t<o;t++){const e=new FLIPBOOK.Page3(this,t);this.pagesArr.push(e),this.centerContainer.appendChild(e.wrapper)}},FLIPBOOK.Book3.prototype=Object.create(FLIPBOOK.Book.prototype),FLIPBOOK.Book3.prototype.constructor=FLIPBOOK.Book3,FLIPBOOK.Book3.prototype.enableIscroll=function(){this.iscrollDisabled&&(this.iscroll.enable(),this.iscrollDisabled=!1)},FLIPBOOK.Book3.prototype.disableIscroll=function(){this.iscrollDisabled||(this.iscroll.disable(),this.iscroll.initiated=!1,this.iscrollDisabled=!0)},FLIPBOOK.Book3.prototype.enableMouseWheelZoom=function(){this.iscroll.options.eventPassthrough="vertical",this.iscroll.refresh()},FLIPBOOK.Book3.prototype.disableMouseWheelZoom=function(){this.iscroll.options.eventPassthrough="",this.iscroll.refresh()},FLIPBOOK.Book3.prototype.enablePrev=function(t){this.prevEnabled=t},FLIPBOOK.Book3.prototype.enablePan=function(){this.iscroll.enable()},FLIPBOOK.Book3.prototype.disablePan=function(){this.iscroll.disable()},FLIPBOOK.Book3.prototype.setRightIndex=function(t){this.rightIndex=t},FLIPBOOK.Book3.prototype.enableNext=function(t){this.nextEnabled=t},FLIPBOOK.Book3.prototype.isZoomed=function(){return this.options.main.zoom>this.options.zoomMin&&this.options.main.zoom>1},FLIPBOOK.Book3.prototype.getNumPages=function(){},FLIPBOOK.Book3.prototype.move=function(t){if(!(this.zoom<=1)){var e=this.iscroll;if(e){var i=e.x,s=e.y,o=20*this.zoom;switch(t){case"left":i+=o;break;case"right":i-=o;break;case"up":s+=o;break;case"down":s-=o}i>0&&(i=0),i<e.maxScrollX&&(i=e.maxScrollX-0),s>0&&(s=0),s<e.maxScrollY&&(s=e.maxScrollY-0),e.scrollTo(i,s,0)}}},FLIPBOOK.Book3.prototype.zoomTo=function(t,e,i,s){if(this.enabled){i=i||0,s=s||0,e=e||0,this.zoom=t,e=0;var o=this.iscroll;o&&o.zoom(t*this.ratio,i,s,e)}},FLIPBOOK.Book3.prototype.setWrapperW=function(t){this.wrapperW!=t&&(this.wrapper.style.width=t+"px",this.wrapperW=t)},FLIPBOOK.Book3.prototype.updateBookPosition=function(){if(this.singlePage)return this.setWrapperW(this.pageWidth),this.iscroll&&this.iscroll.refresh(),this.view=1,void this.focusRight();1==this.view?this.setWrapperW(this.pageWidth):this.setWrapperW(2*this.pageWidth),this.iscroll&&this.iscroll.refresh(),2==this.view?this.isCover()?this.focusRight():this.isBackCover()&&this.options.cover?this.focusLeft():this.focusBoth():1==this.view&&(this.isCover()?this.focusRight():this.isBackCover()&&this.focusLeft())},FLIPBOOK.Book3.prototype.focusLeft=function(t,e){var i=1==this.view||this.singlePage?0:this.pageWidth/2;this.setBookPosition(i,t,e)},FLIPBOOK.Book3.prototype.focusRight=function(t,e,i){var s=1==this.view||this.singlePage?-this.pageWidth:-this.pageWidth/2;this.setBookPosition(s,t,e,i)},FLIPBOOK.Book3.prototype.focusBoth=function(t,e){var i=1==this.view?-this.pageWidth/2:0;this.setBookPosition(i,t,e)},FLIPBOOK.Book3.prototype.setBookPosition=function(t,e,i,s){if(this.centerContainerPosition!=t){var o=this.centerContainerPosition;if(e){var n=this;const h={from:o,to:t,delay:i=i||0,duration:e,step(t){n.centerContainer.style.transform="translateX("+t+"px) "+n.translateZ},complete(){n.centerContainerPosition=t,s&&(n.updateFlipped(),n.options.main.turnPageComplete())}};this.animate(h)}else this.centerContainerPosition!=t&&(this.centerContainerPosition=t,this.centerContainer.style.transform="translateX("+t+"px) "+this.translateZ,this.updateFlipped(),this.options.main.turnPageComplete())}},FLIPBOOK.Book3.prototype.updateSinglePage=function(t){this.singlePage=t;let e=this.rightIndex;e>0&&(this.singlePage?e--:e%2==1&&e++,this.setRightIndex(e)),this.resetLoadedPages(),this.onResize(),this.updateVisiblePages()},FLIPBOOK.Book3.prototype.resetLoadedPages=function(){this.pagesArr.forEach((function(t){t.bgFront.replaceChildren(),t.bgBack.replaceChildren(),t.sizeFront=0,t.sizeBack=0,t.html.front.replaceChildren(),t.html.back.replaceChildren(),t.htmlContent&&(t.htmlContent.front=null,t.htmlContent.back=null),t.htmlLoaded&&(t.htmlLoaded.front=null,t.htmlLoaded.back=null)}))},FLIPBOOK.Book3.prototype.updateVisiblePages=function(t){void 0===t&&(t=!0);var e=this,i=this.rightIndex;this.singlePage||(i/=2);let s=this.options.pages.length,o=this.singlePage?s:s/2;this.options.cover||o++,this.visibleSheets=[];for(let t=0;t<o;t++)this.visibleSheets.push(this.pagesArr[t]);var n=this.visibleSheets[i],h=this.visibleSheets[i+1],a=this.visibleSheets[i-1],r=this.visibleSheets[i-2];a&&a._setAngle(180),n&&n._setAngle(0);for(var l=0;l<this.pagesArr.length;l++)this.pagesArr[l]==n?(this.pagesArr[l].show(),this.pagesArr[l].unpauseHtml("front"),this.pagesArr[l].pauseHtml("back")):this.pagesArr[l]!=a||this.singlePage?(this.pagesArr[l].hide(),this.pagesArr[l].pauseHtml("front"),this.pagesArr[l].pauseHtml("back")):(this.pagesArr[l].show(),this.pagesArr[l].unpauseHtml("back"),this.pagesArr[l].pauseHtml("front")),this.pagesArr[l]._setZIndex(0);this.updateBookPosition(),a&&!this.singlePage?(e.options.main.setLoadingProgress(.1),a.load("back",(function(){e.options.main.setLoadingProgress(1),a.startHTML("back"),n?(e.options.main.setLoadingProgress(.1),n.load("front",(function(){e.options.main.setLoadingProgress(1),n.load("back",null,!0),h&&h.load("front",null,!0),e.options.doublePage&&2==e.view||n.startHTML("front")}))):(a.load("front",null,!0),r&&r.load("back",null,!0))}))):(e.options.main.setLoadingProgress(.1),n.load("front",(function(){e.options.main.setLoadingProgress(1),e.singlePage?a&&a.load("front",null,!0):n.load("back",null,!0),h&&h.load("front",null,!0),n.startHTML("front")})))},FLIPBOOK.Book3.prototype.enable=function(){this.onResize(),this.enabled=!0},FLIPBOOK.Book3.prototype.disable=function(){this.onResize(),this.enabled=!1},FLIPBOOK.Book3.prototype.getLeftPage=function(){return this.pagesArr[this.flippedleft-1]},FLIPBOOK.Book3.prototype.getRightPage=function(){return this.pagesArr[this.flippedleft]},FLIPBOOK.Book3.prototype.getLeftBackPage=function(){return this.pagesArr[this.flippedleft-2]},FLIPBOOK.Book3.prototype.getRightBackPage=function(){return this.pagesArr[this.flippedleft+1]},FLIPBOOK.Book3.prototype.getNextPage=function(){return this.pagesArr[this.flippedleft+2]},FLIPBOOK.Book3.prototype.getPrevPage=function(){return this.pagesArr[this.flippedleft-3]},FLIPBOOK.Book3.prototype.nextPage=function(){if(this.nextEnabled)if(1!=this.view||!this.isFocusedLeft()||this.singlePage)this.goToPage(this.rightIndex+2);else{var t=700*this.options.pageFlipDuration/2;this.focusRight(t,0,!0)}},FLIPBOOK.Book3.prototype.prevPage=function(){if(this.prevEnabled)if(1!=this.view||!this.isFocusedRight()||this.singlePage){var t=this.singlePage?this.rightIndex:this.rightIndex-2;this.goToPage(t)}else{var e=700*this.options.pageFlipDuration/2;this.focusLeft(e,0,!0)}},FLIPBOOK.Book3.prototype.goToPage=function(t,e){if(this.enabled&&!this.flipping&&!isNaN(t)&&((this.singlePage||t%2!=0)&&t--,t<0&&(t=0),t>this.options.pages.length&&(t=this.options.pages.length),t!=this.rightIndex))if(e||this.options.instantFlip)this.setRightIndex(t),this.updateFlipped(),this.updateVisiblePages(),this.options.main.turnPageComplete();else{var i,s=this,o=600*this.options.pageFlipDuration,n=this.flipEasing;t>this.rightIndex?(i=180,(s.angle<=0||s.angle>=180||!s.angle)&&(s.angle=1)):t<this.rightIndex&&(i=-180,(s.angle>=0||s.angle<=-180||!s.angle)&&(s.angle=-1)),this.flipping=!0,this.singlePage||(1==this.view?t<this.rightIndex?this.focusRight(o):this.focusLeft(o):0==t?this.focusRight(o):t==2*this.visibleSheets.length?this.focusLeft(o):this.focusBoth(o)),this.goingToPage=t,this.singlePage&&(o/=2);const e={from:s.angle,to:i,duration:o,easing:n,step(t){s._setPageAngle(t)},complete(){s.setRightIndex(s.goingToPage),s.angle=0,s.flipping=!1,s.updateFlipped(),s.updateVisiblePages(),s.options.main.turnPageComplete()}};this.animate(e),this.options.main.turnPageStart()}},FLIPBOOK.Book3.prototype.animate=function(t){FLIPBOOK.animate(t)},FLIPBOOK.Book3.prototype.updateFlipped=function(){this.singlePage?(this.flippedleft=this.rightIndex,this.flippedright=this.options.pages.length-this.rightIndex):(this.flippedleft=(this.rightIndex+this.rightIndex%2)/2,this.flippedright=this.options.pages.length/2-this.flippedleft)},FLIPBOOK.Book3.prototype.onSwipe=function(t,e,i,s,o,n){if(this.isZoomed()||"flipbook-page-link"===t.target.className||this.flipping)return;const h=180*-i/this.main.wrapperW,a=Math.abs(i);if("start"!==e){if(("end"===e||"cancel"===e)&&n<=1&&a>5)return h>0?this.nextPage():this.prevPage(),void(this.dragging=!1);if("move"===e&&n<=1&&this.dragging&&a>5){let t=h>0?this.singlePage?1:2:this.singlePage?-1:-2;if(h>0&&!this.nextEnabled||h<0&&!this.prevEnabled)return;this.goingToPage=this.rightIndex+t,this.goingToPage!==this.rightIndex&&this.goingToPage>=0&&this.goingToPage<=2*this.pagesArr.length&&!this.options.instantFlip&&this._setPageAngle(h)}}else this.dragging=!0},FLIPBOOK.Book3.prototype.pauseHtml=function(){for(var t=0;t<this.pagesArr.length;t++)this.pagesArr[t].pauseHtml()},FLIPBOOK.Book3.prototype._setPageAngle=function(t){if(this.angle!=t){var e,i,s,o;this.angle=t,this.angle=t;var n,h=this.rightIndex,a=this.goingToPage;if(this.singlePage)o=this.visibleSheets[h],s=this.visibleSheets[h-1],t>0?(o._setAngle(t/2),(i=this.visibleSheets[a])&&(i.show(),i.load("front"))):((s=this.visibleSheets[a]).show(),s.load("front"),s._setAngle(t/2+90)),i&&i._setAngle(0),e&&e._setAngle(90);else{o=this.visibleSheets[h/2],s=this.visibleSheets[h/2-1];var r=this.visibleSheets[a/2-1],l=this.visibleSheets[a/2];if(t>0){if(1==this.view&&this.isFocusedLeft())return;t<90?(n=o,r.hide()):(n=r,o.hide()),n.show(),n._setAngle(t),i=this.visibleSheets[a/2],n.load("back",(function(){i&&(i.show(),i.load("front",null,!0))}),!0)}else{if(1==this.view&&this.isFocusedRight())return;t>-90?(n=s,l.hide()):(n=l,s.hide()),n.show(),n._setAngle(180+t),e=this.visibleSheets[a/2-1],n.load("front",(function(){e&&(e.show(),e.load("back",null,!0))}),!0)}i&&i._setAngle(0),e&&e._setAngle(180)}}},FLIPBOOK.Book3.prototype.isCover=function(){return 0==this.rightIndex},FLIPBOOK.Book3.prototype.isBackCover=function(){return this.rightIndex==this.options.pages.length},FLIPBOOK.Book3.prototype.onPageUnloaded=function(t){var e=t;this.options.rightToLeft&&(e=this.options.pages.length-t-1),this.pagesArr[e]&&this.pagesArr[e].unload()},FLIPBOOK.Book3.prototype.onResize=function(){var t=this,e=this.main,i=e.wrapperW,s=e.wrapperH,o=e.bookW,n=e.bookH,h=e.pageW,a=e.pageH,r=i/s,l=h/a,p=this.options;function g(){t.ratio=s/n,c()}function d(){t.ratio=1==t.view?i/h:i/o,c()}function c(){t.iscroll&&(t.iscroll.options.zoomMin=t.ratio*p.zoomMin),t.iscroll&&(t.iscroll.options.zoomMax=t.ratio*p.zoomMax),t.updateBookPosition(),t.iscroll&&t.iscroll.zoom(t.ratio*p.main.zoom,i/2,s/2,0),t.bookScale=t.iscroll.scale}var f=Math.min(this.zoom,1),u=Number(this.options.zoomMin);this.singlePage||this.options.responsiveView&&i<=this.options.responsiveViewTreshold&&r<2*l&&r<this.options.responsiveViewRatio?(this.view=1,this.sc=l>r?u*r/(l*f):1,i/s>h/a?g():d()):(this.view=2,this.sc=r<2*l?u*r/(2*l*f):1,i/s>=o/n?g():d()),this.updateBookPosition(),this.updateFlipped(),this.options.main.turnPageComplete()},FLIPBOOK.Book3.prototype.isFocusedRight=function(){var t=1==this.view?-this.pageWidth/2:0;return this.singlePage?this.rightIndex%2==0:this.centerContainerPosition<t},FLIPBOOK.Book3.prototype.isFocusedLeft=function(){var t=1==this.view?-this.pageWidth/2:0;return this.singlePage?this.rightIndex%2==1:this.centerContainerPosition>t},FLIPBOOK.Page3=function(t,e){this.book=t,this.main=t.main,this.options=t.options,this.index=e,this.wrapper=document.createElement("div"),this.wrapper.className="flipbook-page3",this.wrapper.style.width=t.options.pageWidth+"px",this.wrapper.style.height=t.options.pageHeight+"px",this.angle=0,this.wrapper.dataset.sheet=e;var i=t.options;let s=i.pagePreloader||i.assets.spinner,o=i.pagePreloader?"flipbook-page-preloader-image":"flipbook-page-preloader";this.front=document.createElement("div"),this.wrapper.appendChild(this.front),this.front.className="flipbook-page3-inner flipbook-page3-inner-front",this.bgFront=document.createElement("div"),this.front.appendChild(this.bgFront),this.bgFront.className="flipbook-page3-bg",this.htmlFront=document.createElement("div"),this.front.appendChild(this.htmlFront),this.htmlFront.className="flipbook-page3-html page_"+String(2*e),this.htmlFront.style.width=1e3*i.pageWidth/i.pageHeight+"px";var n="scale("+this.options.pageHeight/1e3+")";this.options.doublePage&&this.index>0?this.htmlFront.style.transform=n+" translateX(-100%)":this.htmlFront.style.transform=n,this.html={front:this.htmlFront},this.frontHtmlContentVisible=!1,this.preloaderFront=new Image,this.preloaderFront.src=s,this.preloaderFront.className=o,this.front.appendChild(this.preloaderFront),t.singlePage||(this.back=document.createElement("div"),this.wrapper.appendChild(this.back),this.back.className="flipbook-page3-inner flipbook-page3-inner-back",this._setVisibility(this.back,!1),this.bgBack=document.createElement("div"),this.back.appendChild(this.bgBack),this.bgBack.className="flipbook-page3-bg",this.htmlBack=document.createElement("div"),this.back.appendChild(this.htmlBack),this.htmlBack.className="flipbook-page3-html page_"+String(2*e+1),this.htmlBack.style.width=1e3*i.pageWidth/i.pageHeight+"px",this.htmlBack.style.transform=n,this.html.back=this.htmlBack,this.backHtmlContentVisible=!1,this.preloaderBack=new Image,this.preloaderBack.src=s,this.preloaderBack.className=o,this.back.appendChild(this.preloaderBack)),this.htmlPaused={front:!1,back:!1},this.hide(),this.zIndex=0,this.options.rightToLeft&&!this.options.backCover&&e++,this.wrapper.style.left=String(this.book.options.pageWidth-1)+"px"},FLIPBOOK.Page3.prototype={load:function(t,e,i){var s=this.book.pageHeight*this.book.iscroll.scale*window.devicePixelRatio,o=this.options,n=s<o.pageTextureSizeSmall?o.pageTextureSizeSmall:o.pageTextureSize,h="front"==t||this.book.singlePage,a=this.book.singlePage?this.index:h?2*this.index:2*this.index+1,r=o.rightToLeft?o.pages.length-a-1:a;if(this.sizeFront==n&&h&&this.indexFront==r||this.sizeBack==n&&!h&&this.indexBack==r)i||this.loadHTML(t),e&&e.call(this);else{h?this.sizeFront=n:this.sizeBack=n;var l=this;h?this.indexFront=r:this.indexBack=r,o.main.loadPage(r,n,(function(s){if(s&&s.image){var o=s.image[n]||s.image;(h&&"right"==l.options.pages[r].side||l.options.rightToLeft&&h&&"left"==l.options.pages[r].side)&&(o.clone||(o.clone=new Image,o.clone.src=o.src),(o=o.clone).style.transform="translateX(-50%)"),h?(l.bgFront.replaceChildren(o),l.preloaderFront.style.display="none"):(l.bgBack.replaceChildren(o),l.preloaderBack.style.display="none"),i||l.loadHTML(t)}e&&e.call(l)}))}},loadHTML:function(t){var e=this,i="front"==t,s=this.book.singlePage?this.index:i?2*this.index:2*this.index+1,o=this.options,n=o.rightToLeft?o.pages.length-s-1:s;n<0||(this.htmlContent&&this.htmlContent[t]?this.updateHtmlContent(t):this.options.main.loadPageHTML(n,(function(i){e.htmlContent=this.htmlContent||{},e.htmlContent[t]=i,e.updateHtmlContent(t)})))},startHTML:function(t){this.book.startPageItems(this.html[t])},unload:function(){this.size=null,this.mat=!1,this.pageSize=null},pauseHtml:function(t){if(!this.htmlPaused[t]){this.htmlPaused[t]=!0;const o=this.html[t];if(!o)return;this.main.trigger("hidepagehtml",{page:this}),o.querySelectorAll("video, audio").forEach((function(t){t.pause()}));for(var e=o.querySelectorAll("iframe"),i=0;i<e.length;i++){var s=e[i];s.src;this.removedIframes=this.removedIframes||[],this.removedIframes.push({iframe:s,parentNode:s.parentNode}),s.parentNode.removeChild(s)}}},unpauseHtml:function(t){this.htmlPaused[t]=!1,this.removedIframes&&this.removedIframes.length&&this.removedIframes.forEach((function(t){t.parentNode.appendChild(t.iframe)})),this.removedIframes=[]},showHtml:function(){this.htmlContentVisible||(this.htmlContentVisible=!0)},updateHtmlContent:function(t){if(this.htmlLoaded=this.htmlLoaded||{},!this.htmlLoaded[t]){var e=this.htmlContent[t];e.jquery&&(e=e[0]),this.htmlLoaded[t]=!0,this.html[t].appendChild(e),this.main.trigger("showpagehtml",{page:this})}},show:function(){this.hidden&&(this.wrapper.style.display="block",this.setShadowOpacity(0),this.showHtml()),this.hidden=!1},setShadowOpacity:function(t){this.shadowOpacity==t||this.hidden||(this.wrapper.style.setProperty("--page3-shadow-opacity",t),this.shadowOpacity=t)},hide:function(){this.hidden||(this.wrapper.style.display="none",this.setShadowOpacity(0)),this.hidden=!0},_setVisibility:function(t,e){t&&t.dataset.visible!=e&&(t.dataset.visible=e,t.style.opacity=e?"1":"0",t.style.pointerEvents=e?"auto":"none")},_setAngle:function(t){if((t=-t)!=this.angle){var e;this.setShadowOpacity(.2*(1-Math.abs(t+90)/90)),this.wrapper.style.setProperty("--page3-rotate-y",String(t+"deg")),this._setVisibility(this.front,t>-90),this._setVisibility(this.back,t<-90),this.angle=t;var i=0;for(e=0;e<this.book.pagesArr.length;e++)e!=this.index&&this.book.pagesArr[e].zIndex>i&&(i=this.book.pagesArr[e].zIndex);this._setZIndex(i+1)}},_setZIndex:function(t){this.zIndex!=t&&(this.wrapper.style["z-index"]=t),this.zIndex=t}};